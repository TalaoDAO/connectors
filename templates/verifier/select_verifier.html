<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Manage Verifiers - CONNECTORS</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&amp;display=swap" rel="stylesheet"/>
<link href="{{ url_for('static', filename='header.css') }}" rel="stylesheet"/>
<style>
    .container {
      max-width: 1400px;
      margin: 2rem auto;
      padding: 2rem;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    h1 {
      color: var(--primary);
      margin-bottom: 2rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      text-align: left;
      padding: 0.75rem;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: var(--bg-light);
    }
    .actions {
      display: flex;
      gap: 0.5rem;
    }
   .button {
  display: inline-block;       /* Ensures <a> behaves like <button> */
  padding: 0.5rem 1rem;
  border: none;
  border-radius: 8px;
  font-weight: bold;
  font-size: 1rem;
  cursor: pointer;
  text-decoration: none;       /* Removes underline on <a> */
  text-align: center;
  vertical-align: middle;
  line-height: 1.2;
}

    .btn-create {
      background: var(--accent);
      color: white;
      text-decoration: none;
      padding: 0.75rem 1.5rem;
      display: inline-block;
      margin-bottom: 1.5rem;
      border-radius: 8px;
    }
    .btn-delete {
      background: red;
      color: white;
    }
    .btn-edit {
      background: #2f4858;
      color: white;
    }

  
.inline-wait {
  display: none;
  margin: 1rem 0 1.5rem 0;
  padding: 1rem 1.25rem;
  border: 1px solid #cdd7de;
  border-radius: 10px;
  background: #f7fbfc;
  color: #05383b;
  box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}
.inline-wait .row {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  flex-wrap: wrap;
}
.inline-wait .spinner {
  border: 3px solid #eee;
  border-top: 3px solid #053336;
  border-radius: 50%;
  width: 28px;
  height: 28px;
  animation: spin 1s linear infinite;
}
@keyframes spin { 100% { transform: rotate(360deg);} }
.inline-wait .actions {
  margin-left: auto;
  display: flex;
  gap: 0.5rem;
}
.inline-wait .btn {
  padding: 0.4rem 0.8rem;
  border-radius: 8px;
  border: 1px solid transparent;
  cursor: pointer;
  font-weight: 600;
}
.inline-wait .btn-cancel {
  background: white;
  border-color: #cdd7de;
}
.inline-wait .btn-continue {
  background: #2f4858;
  color: #fff;
}
</style>
</head>
<body>
<header>
<div class="logo">
<strong><a href="/" style="color: var(--primary); text-decoration: none;">WALLET-CONNECTORS.COM</a></strong>
</div>
<nav>
    <a href="/verifier/create/{{verifier_type}}">Create</a>
  <!--  <a href="/verifier/swagger">Swagger</a> -->

<a href="/documentation/verifier_select">Explain ?</a>
    {% include "account.html" %}
  </nav>
</header>
<div class="container">
  {% if verifier_type == "sandbox" %}
  <h1>Your Verifiers</h1>
<div aria-live="polite" class="inline-wait" id="inline-wait" role="status">
<div class="row">
<div aria-hidden="true" class="spinner"></div>
<div class="message"><strong>Preparing auditâ€¦</strong> This can take a moment. You can continue or cancel to stay on this page.</div>
<div class="actions">
<button class="btn btn-continue" id="wait-continue" type="button">Continue</button>
<button class="btn btn-cancel" id="wait-cancel" type="button">Cancel</button>
</div>
</div>
</div>

  {% else %}
  <h1>Your Qualified Verifiers</h1>
  {% endif %}

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      <div class="flashes">
        {% for message in messages %}
          <p>{{ message }}</p>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}
  
    <a class="btn-create" href="/verifier/create/{{verifier_type}}">+ Create New Verifier</a>
<table>
<thead>
<tr>
<th>Name</th>
<th>client_id</th>
<th>Credential ID</th>
<th>Client Id Scheme</th>
<th>Actions</th>
</tr>
</thead>
<tbody>
      {% for verifier in verifiers %}
      {% set api = verifier.application_api_json %}
      <tr>
<td>{{ verifier.name }}</td>
<td>{{ api["verifier_id"][:10] + "..." }}</td>
<td>
          {% if verifier.credential_id %}
            {{ verifier.credential_id }}
          {% else %}
            <span style="color: red;">None - To Be Updated</span>
          {% endif %}
        </td>
<td>{{ verifier.client_id_scheme }}</td>
<td class="actions">
<form action="/verifier/delete/{{verifier_type}}/{{ verifier.id }}" method="POST" onsubmit="return confirmDelete('{{ verifier.name }}')">
<button class="button btn-delete" type="submit">Delete</button>
</form>
<a class="button btn-edit" href="/verifier/update/{{verifier_type}}/{{ verifier.id }}">Update</a>
<a class="button btn-edit" href="/verifier/online-test/audit/{{verifier_type}}/{{ verifier.id }}">Audit</a>
<a class="button btn-edit" href="/verifier/online-test/test/{{verifier_type}}/{{ verifier.id }}">Test</a>
          {% if verifier_type == "sandbox" and user.subscription != "free" %}
          <a class="button btn-edit" href="/verifier/go_to_production/{{verifier_type}}/{{ verifier.id }}">Move to Production</a>
          {% elif  verifier_type == "qualified" %}
          <a class="button btn-edit" href="/verifier/go_to_sandbox/{{verifier_type}}/{{ verifier.id }}">Move to Sandbox</a>
          {% endif %}

        </td>
</tr>
      {% else %}
      <tr><td colspan="6">You have no verifiers yet.</td></tr>
      {% endfor %}
    </tbody>
</table>
</div>

{% include "footer.html" %}

<script>
  function toggleDropdown() {
    var dropdown = document.getElementById("dropdown");
    dropdown.style.display = dropdown.style.display === "block" ? "none" : "block";
  }

  // Optional: close dropdown on click outside
  window.onclick = function(event) {
    if (!event.target.matches('.user-icon')) {
      var dropdown = document.getElementById("dropdown");
      if (dropdown && dropdown.style.display === "block") {
        dropdown.style.display = "none";
      }
    }
  };
</script>
<script>
  function confirmDelete(name) {
    return confirm(`Delete verifier "${name}"? This cannot be undone.`);
  }
</script>


<script>
document.querySelectorAll('a[href*="/verifier/online-test/audit/"]').forEach(link => {
  link.addEventListener('click', function(e){
    document.getElementById('loading-overlay').style.display = 'flex';
  });
});
</script>
<script>
(function(){
  let pendingHref = null;
  let pendingTimer = null;

  function showWait(href){
    pendingHref = href;
    const box = document.getElementById('inline-wait');
    if (box) box.style.display = 'block';
    scheduleAutoContinue();
  }

  function hideWait(){
    const box = document.getElementById('inline-wait');
    if (box) box.style.display = 'none';
    if (pendingTimer) { clearTimeout(pendingTimer); pendingTimer = null; }
    pendingHref = null;
  }

  function scheduleAutoContinue(){
    if (pendingTimer) clearTimeout(pendingTimer);
    // Auto-continue after a brief pause unless canceled
    pendingTimer = setTimeout(function(){
      if (pendingHref) window.location.href = pendingHref;
    }, 800);
  }

  document.addEventListener('DOMContentLoaded', function(){
    // Bind audit links
    document.querySelectorAll('a[href*="/verifier/online-test/audit/"]').forEach(link => {
      link.addEventListener('click', function(e){
        e.preventDefault();
        showWait(this.href);
      });
    });

    // Continue button
    const btnContinue = document.getElementById('wait-continue');
    if (btnContinue){
      btnContinue.addEventListener('click', function(){
        if (pendingTimer) { clearTimeout(pendingTimer); pendingTimer = null; }
        if (pendingHref) window.location.href = pendingHref;
      });
    }

    // Cancel button
    const btnCancel = document.getElementById('wait-cancel');
    if (btnCancel){
      btnCancel.addEventListener('click', function(){
        hideWait();
        // Optionally go back to previous page if desired:
        // window.history.back();
      });
    }
  });
})();
</script></body>
</html>
